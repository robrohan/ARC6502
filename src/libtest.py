import ctypes
import os

_file = 'libARC6502.so'
_path = os.path.join("../build", _file)
_mod = ctypes.cdll.LoadLibrary(_path)

####################################

loadROM = _mod.loadROM
loadROM.argtypes = (ctypes.POINTER(ctypes.c_uint8),) #, ctypes.c_int)
loadROM.restype = ctypes.c_ulong

runROM = _mod.runROM
runROM.argtypes = (ctypes.c_uint16,)
runROM.restype = ctypes.POINTER(ctypes.c_uint8)

####################################

rom = [
    0xa9, 0x20, 0x85, 0xdf, 0x4c, 0x4d, 0x80, 0xa5,  0xde, 0x85, 0xda, 0xa5, 0xdf, 0x65, 0xd1, 0x85,
    0xdb, 0xa4, 0xd0, 0xa5, 0xd4, 0x91, 0xda, 0x60,  0xa5, 0xdf, 0x85, 0xdb, 0xa5, 0xde, 0x85, 0xda,
    0xa5, 0xdb, 0x65, 0xd1, 0x65, 0xd3, 0x85, 0xc1,  0xa5, 0xdb, 0x65, 0xd1, 0x85, 0xdb, 0xa5, 0xd2,
    0x85, 0xc0, 0xa5, 0xd4, 0xa4, 0xd0, 0x91, 0xda,  0xe6, 0xda, 0xa5, 0xda, 0xc5, 0xc0, 0xd0, 0xf2,
    0xa9, 0x00, 0x85, 0xda, 0xe6, 0xdb, 0xa5, 0xdb,  0xc5, 0xc1, 0xd0, 0xe6, 0x60, 0xa9, 0x00, 0x85,
    0xd0, 0x85, 0xd1, 0xa9, 0x04, 0x85, 0xd2, 0x85,  0xd3, 0xa9, 0x08, 0x85, 0xd4, 0x20, 0x18, 0x80,
    0xa9, 0x02, 0x85, 0xd0, 0xa9, 0x00, 0x85, 0xd1,  0xa9, 0x02, 0x85, 0xd2, 0xa9, 0x00, 0x85, 0xd3,
    0xa9, 0x06, 0x85, 0xd4, 0x20, 0x18, 0x80, 0x60,  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
]

####################################

arr = (ctypes.c_uint8 * len(rom))(*rom)

####################################

loadROM(arr)
result = runROM(10000)

####################################
rlen = 0x6000
stride = 256
wxh = 4
row = 0
for i in range(0, rlen, stride):
    row += 1
    chunk = result[i:i + stride]
    print(chunk[:wxh]) #, end=" ")
    if row == wxh:
         break
